<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="description" content="éŸ“åœ‹æ—…éŠè¦åŠƒ - è¡Œç¨‹è¦åŠƒã€è¨˜å¸³ã€å¿…å‚™ç‰©å“æ¸…å–®">
    <meta name="theme-color" content="#4a90e2">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="éŸ“åœ‹æ—…éŠ">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">
    <link rel="stylesheet" href="style.css">
    <title>éŸ“åœ‹æ—…éŠè¦åŠƒ</title>
</head>
<body>
    <div id="app">
        <div class="container">
            <header>
                <h1>ğŸ‡°ğŸ‡· éŸ“åœ‹æ—…éŠè¦åŠƒ</h1>
                <p>è¼•é¬†ç®¡ç†æ‚¨çš„éŸ“åœ‹ä¹‹æ—…</p>
            </header>

            <div class="tabs">
                <button 
                    v-for="tab in tabs" 
                    :key="tab.id"
                    @click="activeTab = tab.id"
                    :class="['tab-btn', { active: activeTab === tab.id }]"
                >
                    {{ tab.name }}
                </button>
            </div>

            <!-- PWA å®‰è£æç¤º -->
            <div v-if="showInstallButton" style="background: #4a90e2; color: white; padding: 15px; margin-bottom: 20px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px;">
                <div>
                    <strong>ğŸ“± å®‰è£åˆ°æ‰‹æ©Ÿ</strong>
                    <div style="font-size: 14px; margin-top: 5px;">å°‡æ­¤æ‡‰ç”¨å®‰è£åˆ°ä¸»ç•«é¢ï¼ŒåƒAPPä¸€æ¨£ä½¿ç”¨</div>
                </div>
                <button @click="installApp" class="btn" style="background: white; color: #4a90e2; margin: 0;">å®‰è£</button>
            </div>

            <!-- æ¯æ—¥è¡Œç¨‹ç¸½è¦½ -->
            <div v-show="activeTab === 'daily'" class="tab-content">
                <h2 style="margin-bottom: 20px;">æ¯æ—¥è¡Œç¨‹ç¸½è¦½</h2>
                
                <!-- å¤©æ•¸é¸æ“‡ -->
                <div v-if="tripDays.length > 0" style="margin-bottom: 20px;">
                    <div class="form-group">
                        <label>é¸æ“‡å¤©æ•¸</label>
                        <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-top: 10px;">
                            <button 
                                v-for="day in tripDays" 
                                :key="day.dayNumber"
                                @click="selectedDayNumber = day.dayNumber"
                                :class="['btn', { active: selectedDayNumber === day.dayNumber }]"
                                :style="{
                                    background: selectedDayNumber === day.dayNumber ? '#4a90e2' : 'white',
                                    color: selectedDayNumber === day.dayNumber ? 'white' : '#4a90e2',
                                    border: '2px solid #4a90e2',
                                    padding: '10px 20px',
                                    fontSize: '14px'
                                }"
                            >
                                {{ day.label }}
                            </button>
                        </div>
                    </div>
                    <div style="margin-top: 10px; padding: 10px; background: #e8f4f8; border-radius: 6px;">
                        <div style="font-size: 14px; color: #666;">
                            <strong>è¡Œç¨‹æœŸé–“ï¼š</strong>{{ formatDateRange(tripStartDate, tripEndDate) }}
                        </div>
                        <div v-if="currentDayInfo" style="font-size: 14px; color: #666; margin-top: 5px;">
                            <strong>æ—¥æœŸï¼š</strong>{{ formatDate(currentDayInfo.date) }}
                        </div>
                    </div>
                </div>
                
                <div v-else style="padding: 20px; background: #fff3cd; border-radius: 6px; margin-bottom: 20px;">
                    <p style="color: #856404; margin: 0;">
                        âš ï¸ è«‹å…ˆæ–°å¢æ©Ÿç¥¨è³‡è¨Šï¼Œç³»çµ±æœƒè‡ªå‹•æ ¹æ“šæ‰€æœ‰è¡Œç¨‹è³‡æ–™ï¼ˆæ©Ÿç¥¨ã€è¡Œç¨‹ã€ä½å®¿ï¼‰è¨ˆç®—å¤©æ•¸
                    </p>
                </div>

                <div v-if="dailySchedule.length === 0 && tripDays.length > 0" class="empty-state">
                    {{ currentDayInfo ? currentDayInfo.label : 'Day1' }} ç•¶æ—¥å°šç„¡è¡Œç¨‹å®‰æ’
                </div>

                <div v-else-if="dailySchedule.length > 0">
                    <h3 style="margin-bottom: 15px; color: #4a90e2;">
                        {{ currentDayInfo ? currentDayInfo.label : 'Day1' }} - {{ currentDayInfo ? formatDate(currentDayInfo.date) : formatDate(selectedDate) }} çš„è¡Œç¨‹
                    </h3>
                    <div v-for="(item, index) in dailySchedule" :key="index" class="list-item" :style="{ borderLeftColor: item.color }">
                        <div class="list-item-header">
                            <div>
                                <span style="background: #4a90e2; color: white; padding: 2px 8px; border-radius: 4px; font-size: 12px; margin-right: 8px;">
                                    {{ item.time }}
                                </span>
                                <span class="list-item-title">{{ item.title }}</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <button v-if="item.locationData && item.locationData.lat" @click="showMap(item.locationData)" class="btn btn-map" style="padding: 4px 8px; font-size: 11px;">åœ°åœ–</button>
                                <button v-if="item.locationData && item.locationData.lat" @click="showRoute(item.locationData)" class="btn btn-route" style="padding: 4px 8px; font-size: 11px;">è·¯ç·š</button>
                                <span style="font-size: 12px; color: #999;">
                                    {{ item.type }}
                                </span>
                            </div>
                        </div>
                        <div class="list-item-info" v-if="item.details">
                            {{ item.details }}
                        </div>
                        <div v-if="item.extraInfo" class="list-item-info" style="margin-top: 5px; color: #856404; background: #fff3cd; padding: 8px; border-radius: 4px;">
                            ğŸš‡ {{ item.extraInfo }}
                        </div>
                        <div v-if="item.locationData && item.locationData.fromItineraryId" style="margin-top: 8px;">
                            <button @click="showRouteBetween(item.locationData.fromItineraryId, item.locationData)" class="btn btn-route" style="padding: 4px 8px; font-size: 11px;">æŸ¥çœ‹è©³ç´°è·¯ç·š</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- æ©Ÿç¥¨/è»Šç¥¨æ™‚é–“ -->
            <div v-show="activeTab === 'transport'" class="tab-content">
                <h2 style="margin-bottom: 20px;">æ©Ÿç¥¨/è»Šç¥¨æ™‚é–“</h2>
                <form @submit.prevent="addTransport">
                    <div class="form-row">
                        <div class="form-group">
                            <label>é¡å‹</label>
                            <select v-model="newTransport.type" required>
                                <option value="">è«‹é¸æ“‡</option>
                                <option value="æ©Ÿç¥¨">æ©Ÿç¥¨</option>
                                <option value="é«˜éµ">é«˜éµ</option>
                                <option value="åœ°éµ">åœ°éµ</option>
                                <option value="å·´å£«">å·´å£«</option>
                                <option value="è¨ˆç¨‹è»Š">è¨ˆç¨‹è»Š</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>å‡ºç™¼åœ°</label>
                            <input type="text" v-model="newTransport.from" required placeholder="ä¾‹å¦‚ï¼šå°åŒ—">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>ç›®çš„åœ°</label>
                            <input type="text" v-model="newTransport.to" required placeholder="ä¾‹å¦‚ï¼šé¦–çˆ¾">
                        </div>
                        <div class="form-group">
                            <label>æ—¥æœŸ</label>
                            <input type="date" v-model="newTransport.date" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>å‡ºç™¼æ™‚é–“</label>
                            <input type="time" v-model="newTransport.departureTime" required>
                        </div>
                        <div class="form-group">
                            <label>æŠµé”æ™‚é–“</label>
                            <input type="time" v-model="newTransport.arrivalTime" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>å‚™è¨»</label>
                        <textarea v-model="newTransport.notes" placeholder="èˆªç­è™Ÿç¢¼ã€åº§ä½è™Ÿç­‰"></textarea>
                    </div>
                    <button type="submit" class="btn">æ–°å¢</button>
                </form>

                <div style="margin-top: 30px;">
                    <h3 style="margin-bottom: 15px;">å·²è¨˜éŒ„çš„äº¤é€šè³‡è¨Š</h3>
                    <div v-if="transports.length === 0" class="empty-state">
                        å°šç„¡è¨˜éŒ„
                    </div>
                    <div v-for="(transport, index) in transports" :key="index" class="list-item">
                        <div class="list-item-header">
                            <div class="list-item-title">{{ transport.type }}ï¼š{{ transport.from }} â†’ {{ transport.to }}</div>
                            <div class="list-item-actions">
                                <button @click="editTransport(index)" class="btn btn-secondary" style="padding: 6px 12px; font-size: 12px;">ç·¨è¼¯</button>
                                <button @click="deleteTransport(index)" class="btn btn-danger" style="padding: 6px 12px; font-size: 12px;">åˆªé™¤</button>
                            </div>
                        </div>
                        <div class="list-item-info">æ—¥æœŸï¼š{{ transport.date }}</div>
                        <div class="list-item-info">æ™‚é–“ï¼š{{ transport.departureTime }} - {{ transport.arrivalTime }}</div>
                        <div v-if="transport.notes" class="list-item-info">å‚™è¨»ï¼š{{ transport.notes }}</div>
                    </div>
                </div>
            </div>

            <!-- è¡Œç¨‹è¦åŠƒ -->
            <div v-show="activeTab === 'itinerary'" class="tab-content">
                <h2 style="margin-bottom: 20px;">è¡Œç¨‹è¦åŠƒ</h2>
                <form @submit.prevent="addItinerary">
                    <div class="form-row">
                        <div class="form-group">
                            <label>æ—¥æœŸ</label>
                            <input type="date" v-model="newItinerary.date" required>
                        </div>
                        <div class="form-group">
                            <label>æ™‚é–“</label>
                            <input type="time" v-model="newItinerary.time" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>åœ°é»/æ´»å‹•</label>
                        <div class="location-input-group">
                            <input 
                                type="text" 
                                v-model="newItinerary.location" 
                                @input="searchPlaces"
                                @focus="showSuggestions = true"
                                required 
                                placeholder="ä¾‹å¦‚ï¼šæ˜æ´ã€æ™¯ç¦å®®"
                                id="location-input"
                            >
                            <div v-if="showSuggestions && placeSuggestions.length > 0" class="autocomplete-suggestions">
                                <div 
                                    v-for="(suggestion, idx) in placeSuggestions" 
                                    :key="idx"
                                    @click="selectPlace(suggestion)"
                                    class="suggestion-item"
                                >
                                    <div style="font-weight: 600;">{{ suggestion.name }}</div>
                                    <div style="font-size: 12px; color: #666;">{{ suggestion.address }}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div v-if="newItinerary.address" class="form-group">
                        <label>åœ°å€</label>
                        <input type="text" v-model="newItinerary.address" readonly style="background: #f5f5f5;">
                    </div>
                    <div v-if="newItinerary.lat && newItinerary.lng" class="form-row">
                        <div class="form-group">
                            <label>ç·¯åº¦</label>
                            <input type="text" v-model="newItinerary.lat" readonly style="background: #f5f5f5;">
                        </div>
                        <div class="form-group">
                            <label>ç¶“åº¦</label>
                            <input type="text" v-model="newItinerary.lng" readonly style="background: #f5f5f5;">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>å¾å“ªå€‹è¡Œç¨‹å‡ºç™¼ï¼ˆé¸å¡«ï¼‰</label>
                        <select v-model="newItinerary.fromItineraryId">
                            <option value="">ç„¡ï¼ˆç¨ç«‹è¡Œç¨‹ï¼‰</option>
                            <option 
                                v-for="(itinerary, idx) in availablePreviousItineraries" 
                                :key="idx"
                                :value="itinerary.originalIndex"
                            >
                                {{ itinerary.date }} {{ itinerary.time }} - {{ itinerary.location }}
                            </option>
                        </select>
                        <small style="color: #666; display: block; margin-top: 5px;">é¸æ“‡å¾Œæœƒè‡ªå‹•è¨ˆç®—å¾ä¸Šä¸€å€‹è¡Œç¨‹åˆ°é€™è£¡çš„è·¯ç·š</small>
                    </div>
                    <div class="form-group">
                        <label>è©³ç´°èªªæ˜</label>
                        <textarea v-model="newItinerary.description" placeholder="æ´»å‹•å…§å®¹ã€æ³¨æ„äº‹é …ç­‰"></textarea>
                    </div>
                    <button type="submit" class="btn">æ–°å¢è¡Œç¨‹</button>
                </form>

                <div style="margin-top: 30px;">
                    <h3 style="margin-bottom: 15px;">è¡Œç¨‹åˆ—è¡¨</h3>
                    <div v-if="itineraries.length === 0" class="empty-state">
                        å°šç„¡è¡Œç¨‹
                    </div>
                    <div v-for="(itinerary, index) in sortedItineraries" :key="index" class="list-item">
                        <!-- é¡¯ç¤ºå¾ä¸Šä¸€å€‹è¡Œç¨‹åˆ°é€™è£¡çš„è·¯ç·š -->
                        <div v-if="itinerary.fromItineraryId !== '' && itinerary.fromItineraryId !== null && itinerary.routeInfo" class="route-between">
                            <div class="route-between-title">
                                ğŸš‡ å¾ {{ getItineraryName(itinerary.fromItineraryId) }} åˆ°é€™è£¡çš„è·¯ç·š
                            </div>
                            <div class="transit-details">
                                <div v-for="(route, routeIdx) in itinerary.routeInfo" :key="routeIdx" style="margin-bottom: 10px;">
                                    <div style="font-weight: 600; margin-bottom: 5px;">
                                        {{ route.mode === 'TRANSIT' ? 'ğŸš‡ å¤§çœ¾é‹è¼¸' : route.mode === 'DRIVING' ? 'ğŸš— é–‹è»Š' : route.mode === 'WALKING' ? 'ğŸš¶ æ­¥è¡Œ' : 'ğŸš´ å–®è»Š' }}
                                        <span style="color: #666; font-size: 12px; margin-left: 10px;">
                                            {{ route.duration }} | {{ route.distance }}
                                        </span>
                                    </div>
                                    <div v-if="route.transitDetails" class="transit-step metro">
                                        <div v-for="(step, stepIdx) in route.transitDetails" :key="stepIdx" style="margin: 8px 0;">
                                            <div v-if="step.type === 'WALKING'" class="transit-step walk">
                                                <strong>ğŸš¶ æ­¥è¡Œ</strong> {{ step.instruction }}
                                                <span v-if="step.duration">ï¼ˆ{{ step.duration }}ï¼‰</span>
                                            </div>
                                            <div v-else-if="step.type === 'TRANSIT'" class="transit-step metro">
                                                <div>
                                                    <span class="station-name">{{ step.departureStop }}</span>
                                                    <span class="line-name">{{ step.lineName }}</span>
                                                    <span style="color: #666;">â†’</span>
                                                    <span class="station-name">{{ step.arrivalStop }}</span>
                                                </div>
                                                <div style="font-size: 12px; color: #666; margin-top: 4px;">
                                                    {{ step.headsign }} | {{ step.numStops }}ç«™ | {{ step.duration }}
                                                </div>
                                            </div>
                                            <div v-else-if="step.type === 'TRANSFER'" class="transit-step transfer">
                                                <strong>ğŸ”„ è½‰ä¹˜</strong> åœ¨ <span class="station-name">{{ step.station }}</span> è½‰ä¹˜
                                                <span v-if="step.toLine" class="line-name" style="margin-left: 5px;">{{ step.toLine }}</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div v-else>
                                        <div v-for="(step, stepIdx) in route.steps" :key="stepIdx" style="margin: 4px 0; padding-left: 10px; border-left: 2px solid #ddd; font-size: 13px;">
                                            {{ step.instruction }}
                                            <span v-if="step.duration" style="color: #999;">ï¼ˆ{{ step.duration }}ï¼‰</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="list-item-header">
                            <div class="list-item-title">{{ itinerary.location }}</div>
                            <div class="list-item-actions">
                                <button v-if="itinerary.lat && itinerary.lng" @click="showMap(itinerary)" class="btn btn-map">æŸ¥çœ‹åœ°åœ–</button>
                                <button v-if="itinerary.lat && itinerary.lng && itinerary.fromItineraryId !== '' && itinerary.fromItineraryId !== null" @click="showRouteBetween(itinerary.fromItineraryId, index)" class="btn btn-route">æŸ¥çœ‹è·¯ç·š</button>
                                <button v-else-if="itinerary.lat && itinerary.lng && availablePreviousItineraries.length > 0" @click="quickSetRoute(index)" class="btn quick-route-btn">è¨­å®šè·¯ç·š</button>
                                <button v-else-if="itinerary.lat && itinerary.lng" @click="showRoute(itinerary)" class="btn btn-route">è·¯ç·šè¦åŠƒ</button>
                                <button @click="editItinerary(index)" class="btn btn-secondary" style="padding: 6px 12px; font-size: 12px;">ç·¨è¼¯</button>
                                <button @click="deleteItinerary(index)" class="btn btn-danger" style="padding: 6px 12px; font-size: 12px;">åˆªé™¤</button>
                            </div>
                        </div>
                        <div class="list-item-info">æ—¥æœŸï¼š{{ itinerary.date }} | æ™‚é–“ï¼š{{ itinerary.time }}</div>
                        <div v-if="itinerary.address" class="list-item-info">åœ°å€ï¼š{{ itinerary.address }}</div>
                        <div v-if="itinerary.description" class="list-item-info">{{ itinerary.description }}</div>
                    </div>
                </div>
            </div>

            <!-- å…¥ä½è³‡æ–™ -->
            <div v-show="activeTab === 'accommodation'" class="tab-content">
                <h2 style="margin-bottom: 20px;">å…¥ä½è³‡æ–™</h2>
                <form @submit.prevent="addAccommodation">
                    <div class="form-group">
                        <label>é£¯åº—/ä½å®¿åç¨±</label>
                        <input type="text" v-model="newAccommodation.name" required placeholder="ä¾‹å¦‚ï¼šé¦–çˆ¾æ¨‚å¤©é…’åº—">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>å…¥ä½æ—¥æœŸ</label>
                            <input type="date" v-model="newAccommodation.checkIn" required>
                        </div>
                        <div class="form-group">
                            <label>é€€æˆ¿æ—¥æœŸ</label>
                            <input type="date" v-model="newAccommodation.checkOut" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>åœ°å€</label>
                        <input type="text" v-model="newAccommodation.address" placeholder="è©³ç´°åœ°å€">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>è¯çµ¡é›»è©±</label>
                            <input type="text" v-model="newAccommodation.phone" placeholder="é£¯åº—é›»è©±">
                        </div>
                        <div class="form-group">
                            <label>æˆ¿é–“è™Ÿç¢¼</label>
                            <input type="text" v-model="newAccommodation.roomNumber" placeholder="æˆ¿é–“è™Ÿ">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>å‚™è¨»</label>
                        <textarea v-model="newAccommodation.notes" placeholder="å…¶ä»–è³‡è¨Š"></textarea>
                    </div>
                    <button type="submit" class="btn">æ–°å¢ä½å®¿</button>
                </form>

                <div style="margin-top: 30px;">
                    <h3 style="margin-bottom: 15px;">ä½å®¿è¨˜éŒ„</h3>
                    <div v-if="accommodations.length === 0" class="empty-state">
                        å°šç„¡è¨˜éŒ„
                    </div>
                    <div v-for="(accommodation, index) in accommodations" :key="index" class="list-item">
                        <div class="list-item-header">
                            <div class="list-item-title">{{ accommodation.name }}</div>
                            <div class="list-item-actions">
                                <button @click="editAccommodation(index)" class="btn btn-secondary" style="padding: 6px 12px; font-size: 12px;">ç·¨è¼¯</button>
                                <button @click="deleteAccommodation(index)" class="btn btn-danger" style="padding: 6px 12px; font-size: 12px;">åˆªé™¤</button>
                            </div>
                        </div>
                        <div class="list-item-info">å…¥ä½ï¼š{{ accommodation.checkIn }} | é€€æˆ¿ï¼š{{ accommodation.checkOut }}</div>
                        <div v-if="accommodation.address" class="list-item-info">åœ°å€ï¼š{{ accommodation.address }}</div>
                        <div v-if="accommodation.phone" class="list-item-info">é›»è©±ï¼š{{ accommodation.phone }}</div>
                        <div v-if="accommodation.roomNumber" class="list-item-info">æˆ¿é–“ï¼š{{ accommodation.roomNumber }}</div>
                        <div v-if="accommodation.notes" class="list-item-info">å‚™è¨»ï¼š{{ accommodation.notes }}</div>
                    </div>
                </div>
            </div>

            <!-- å¿…å‚™ç‰©å“æ¸…å–® -->
            <div v-show="activeTab === 'checklist'" class="tab-content">
                <h2 style="margin-bottom: 20px;">å¿…å‚™ç‰©å“æ¸…å–®</h2>
                
                <!-- äººå“¡è¨­å®š -->
                <div class="form-group" style="background: #e8f4f8; padding: 15px; border-radius: 6px; margin-bottom: 20px;">
                    <label style="margin-bottom: 10px; display: block;">äººå“¡è¨­å®š</label>
                    <div class="form-row">
                        <div class="form-group" style="margin-bottom: 0;">
                            <label style="font-size: 14px;">äººå“¡ 1 åç¨±</label>
                            <input type="text" v-model="person1Name" placeholder="ä¾‹å¦‚ï¼šå°æ˜" style="margin-top: 5px;">
                        </div>
                        <div class="form-group" style="margin-bottom: 0;">
                            <label style="font-size: 14px;">äººå“¡ 2 åç¨±</label>
                            <input type="text" v-model="person2Name" placeholder="ä¾‹å¦‚ï¼šå°è¯" style="margin-top: 5px;">
                        </div>
                    </div>
                </div>

                <!-- æ–°å¢ç‰©å“è¡¨å–® -->
                <form @submit.prevent="addChecklistItem">
                    <div class="form-group">
                        <label>ç‰©å“åç¨±</label>
                        <input type="text" v-model="newChecklistItem.name" required placeholder="ä¾‹å¦‚ï¼šè­·ç…§ã€å……é›»å™¨">
                    </div>
                    <button type="submit" class="btn">æ–°å¢ç‰©å“</button>
                </form>

                <!-- ç‰©å“æ¸…å–® -->
                <div style="margin-top: 30px;">
                    <h3 style="margin-bottom: 15px;">ç‰©å“æ¸…å–®</h3>
                    <div v-if="checklistItems.length === 0" class="empty-state">
                        å°šç„¡ç‰©å“
                    </div>
                    <div class="checklist-container">
                        <div v-for="(item, index) in checklistItems" :key="index" class="checklist-item">
                            <div class="checklist-item-name" :class="{ completed: isItemCompleted(item) }">
                                {{ item.name }}
                            </div>
                            <div class="checklist-people">
                                <div class="person-checkbox">
                                    <input 
                                        type="checkbox" 
                                        :id="`person1-${index}`"
                                        :checked="item.person1Checked"
                                        @change="toggleChecklistItem(index, 'person1')"
                                    >
                                    <label :for="`person1-${index}`" class="person-name">
                                        {{ person1Name || 'äººå“¡ 1' }}
                                    </label>
                                </div>
                                <div class="person-checkbox">
                                    <input 
                                        type="checkbox" 
                                        :id="`person2-${index}`"
                                        :checked="item.person2Checked"
                                        @change="toggleChecklistItem(index, 'person2')"
                                    >
                                    <label :for="`person2-${index}`" class="person-name">
                                        {{ person2Name || 'äººå“¡ 2' }}
                                    </label>
                                </div>
                                <button @click="deleteChecklistItem(index)" class="btn btn-danger" style="padding: 6px 12px; font-size: 12px; margin-left: 10px;">åˆªé™¤</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- å®Œæˆåº¦çµ±è¨ˆ -->
                    <div v-if="checklistItems.length > 0" class="summary-card" style="margin-top: 20px;">
                        <h4 style="margin-bottom: 10px;">å®Œæˆåº¦çµ±è¨ˆ</h4>
                        <div class="summary-item">
                            <span>{{ person1Name || 'äººå“¡ 1' }}ï¼š</span>
                            <span>{{ getPersonCompletion('person1') }}% ({{ getPersonCheckedCount('person1') }}/{{ checklistItems.length }})</span>
                        </div>
                        <div class="summary-item">
                            <span>{{ person2Name || 'äººå“¡ 2' }}ï¼š</span>
                            <span>{{ getPersonCompletion('person2') }}% ({{ getPersonCheckedCount('person2') }}/{{ checklistItems.length }})</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- è¨˜å¸³åŠŸèƒ½ -->
            <div v-show="activeTab === 'expense'" class="tab-content">
                <h2 style="margin-bottom: 20px;">è¨˜å¸³åŠŸèƒ½</h2>
                
                <div class="summary-card">
                    <div class="form-group" style="margin-bottom: 15px;">
                        <label>åŒ¯ç‡è¨­å®šï¼ˆ1éŸ“å…ƒ = ? å°å¹£ï¼‰</label>
                        <input type="number" v-model.number="exchangeRate" step="0.0001" min="0" style="max-width: 200px;">
                        <small style="color: #666; display: block; margin-top: 5px;">é è¨­ï¼š0.025ï¼ˆç´„ 1å°å¹£ = 40éŸ“å…ƒï¼‰</small>
                    </div>
                    <h3 style="margin-bottom: 15px;">ç¸½è¦½</h3>
                    <div class="summary-item">
                        <span>ç¸½æ”¶å…¥ï¼š</span>
                        <div style="text-align: right;">
                            <div class="amount income">â‚©{{ totalIncome.toLocaleString() }}</div>
                            <div style="font-size: 12px; color: #666;">NT${{ totalIncomeTWD.toLocaleString() }}</div>
                        </div>
                    </div>
                    <div class="summary-item">
                        <span>ç¸½æ”¯å‡ºï¼š</span>
                        <div style="text-align: right;">
                            <div class="amount expense">â‚©{{ totalExpense.toLocaleString() }}</div>
                            <div style="font-size: 12px; color: #666;">NT${{ totalExpenseTWD.toLocaleString() }}</div>
                        </div>
                    </div>
                    <div class="summary-item" style="border-top: 1px solid #ccc; padding-top: 10px; margin-top: 10px;">
                        <span><strong>çµé¤˜ï¼š</strong></span>
                        <div style="text-align: right;">
                            <span class="amount" :style="{ color: balance >= 0 ? '#27ae60' : '#e74c3c' }">
                                â‚©{{ balance.toLocaleString() }}
                            </span>
                            <div style="font-size: 12px; color: #666;">NT${{ balanceTWD.toLocaleString() }}</div>
                        </div>
                    </div>
                </div>

                <form @submit.prevent="addExpense">
                    <div class="form-row">
                        <div class="form-group">
                            <label>é¡å‹</label>
                            <select v-model="newExpense.type" required>
                                <option value="">è«‹é¸æ“‡</option>
                                <option value="income">æ”¶å…¥</option>
                                <option value="expense">æ”¯å‡º</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>é‡‘é¡ (â‚©)</label>
                            <input type="number" v-model.number="newExpense.amount" required min="0" placeholder="0">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>é¡åˆ¥</label>
                        <select v-model="newExpense.category" required>
                            <option value="">è«‹é¸æ“‡</option>
                            <option v-if="newExpense.type === 'income'" value="æ›åŒ¯">æ›åŒ¯</option>
                            <option v-if="newExpense.type === 'income'" value="å…¶ä»–æ”¶å…¥">å…¶ä»–æ”¶å…¥</option>
                            <option v-if="newExpense.type === 'expense'" value="é¤é£²">é¤é£²</option>
                            <option v-if="newExpense.type === 'expense'" value="è³¼ç‰©">è³¼ç‰©</option>
                            <option v-if="newExpense.type === 'expense'" value="äº¤é€š">äº¤é€š</option>
                            <option v-if="newExpense.type === 'expense'" value="ä½å®¿">ä½å®¿</option>
                            <option v-if="newExpense.type === 'expense'" value="æ™¯é»é–€ç¥¨">æ™¯é»é–€ç¥¨</option>
                            <option v-if="newExpense.type === 'expense'" value="å…¶ä»–">å…¶ä»–</option>
                        </select>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>æ—¥æœŸ</label>
                            <input type="date" v-model="newExpense.date" required>
                        </div>
                        <div class="form-group">
                            <label>æ™‚é–“</label>
                            <input type="time" v-model="newExpense.time" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>å‚™è¨»</label>
                        <input type="text" v-model="newExpense.notes" placeholder="èªªæ˜">
                    </div>
                    <button type="submit" class="btn">æ–°å¢è¨˜éŒ„</button>
                </form>

                <div style="margin-top: 30px;">
                    <h3 style="margin-bottom: 15px;">è¨˜éŒ„åˆ—è¡¨</h3>
                    <div v-if="expenses.length === 0" class="empty-state">
                        å°šç„¡è¨˜éŒ„
                    </div>
                    <div v-for="(expense, index) in sortedExpenses" :key="index" class="list-item">
                        <div class="list-item-header">
                            <div>
                                <span class="list-item-title">{{ expense.category }}</span>
                                <div style="margin-left: 10px; display: inline-block;">
                                    <span class="amount" :class="expense.type">
                                        {{ expense.type === 'income' ? '+' : '-' }}â‚©{{ expense.amount.toLocaleString() }}
                                    </span>
                                    <div style="font-size: 12px; color: #666; margin-top: 2px;">
                                        {{ expense.type === 'income' ? '+' : '-' }}NT${{ convertToTWD(expense.amount).toLocaleString() }}
                                    </div>
                                </div>
                            </div>
                            <div class="list-item-actions">
                                <button @click="editExpense(index)" class="btn btn-secondary" style="padding: 6px 12px; font-size: 12px;">ç·¨è¼¯</button>
                                <button @click="deleteExpense(index)" class="btn btn-danger" style="padding: 6px 12px; font-size: 12px;">åˆªé™¤</button>
                            </div>
                        </div>
                        <div class="list-item-info">æ—¥æœŸï¼š{{ expense.date }} | æ™‚é–“ï¼š{{ expense.time }}</div>
                        <div v-if="expense.notes" class="list-item-info">å‚™è¨»ï¼š{{ expense.notes }}</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- åœ°åœ–æ¨¡æ…‹è¦–çª— -->
        <div :class="['map-modal', { active: showMapModal }]" @click.self="closeMapModal">
            <div class="map-modal-content">
                <button class="map-modal-close" @click="closeMapModal">&times;</button>
                <h3 style="margin-bottom: 15px;">{{ currentLocationName }}</h3>
                <div id="map" class="map-container"></div>
                <div v-if="routeInfo" class="route-info">
                    <h4 style="margin-bottom: 10px;">è·¯ç·šè¦åŠƒ</h4>
                    <div v-for="(route, idx) in routeInfo" :key="idx" class="route-option">
                        <div class="route-option-title">
                            {{ route.mode === 'TRANSIT' ? 'ğŸš‡ å¤§çœ¾é‹è¼¸' : route.mode === 'DRIVING' ? 'ğŸš— é–‹è»Š' : route.mode === 'WALKING' ? 'ğŸš¶ æ­¥è¡Œ' : 'ğŸš´ å–®è»Š' }}
                        </div>
                        <div class="route-option-details">
                            <div>æ™‚é–“ï¼š{{ route.duration }}</div>
                            <div>è·é›¢ï¼š{{ route.distance }}</div>
                            <div v-if="route.steps" style="margin-top: 8px; font-size: 12px;">
                                <div v-for="(step, stepIdx) in route.steps" :key="stepIdx" style="margin: 4px 0; padding-left: 10px; border-left: 2px solid #ddd;">
                                    {{ step.instruction }}
                                    <span v-if="step.duration" style="color: #999;">ï¼ˆ{{ step.duration }}ï¼‰</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- è¼‰å…¥ Vue èˆ‡ä¸»ç¨‹å¼ -->
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

<!-- ğŸ”¥ Firebase åˆå§‹åŒ–ï¼ˆæ–°å¢é€™æ®µï¼‰ -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import {
    getFirestore,
    doc,
    getDoc,
    setDoc,
    onSnapshot
  } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

  // â¬‡â¬‡â¬‡ æŠŠé€™è£¡æ›æˆä½ å‰›å‰›çœ‹åˆ°çš„ firebaseConfig â¬‡â¬‡â¬‡
  const firebaseConfig = {
    apiKey: "AIzaSyBGgCKVVDF7AUcsd8VrisM3p6fWPIx1iow",
    authDomain: "korea-travel-planner.firebaseapp.com",
    projectId: "korea-travel-planner",
    storageBucket: "korea-travel-planner.firebasestorage.app",
    messagingSenderId: "408025232778",
    appId: "1:408025232778:web:ccd3e4746b2a654ec84473"
  };
  // â¬†â¬†â¬† é€™ä¸€æ•´å€‹ç‰©ä»¶ç”¨ä½ çš„è¨­å®šè¦†è“‹ â¬†â¬†â¬†

  const fbApp = initializeApp(firebaseConfig);
  const db = getFirestore(fbApp);

  // é€™å€‹ tripId ä»£è¡¨ã€ŒåŒä¸€ä»½è¡Œç¨‹ã€ï¼Œ
  // ä½ å¯ä»¥æ”¹æˆåˆ¥çš„å­—ä¸²ï¼Œé¡ä¼¼æˆ¿è™Ÿçš„æ¦‚å¿µ
  const tripId = "korea-shared-trip";

  const tripDocRef = doc(db, "trips", tripId);

  // æš´éœ²çµ¦ app.js ç”¨
  window.firebaseDB = db;
  window.tripDocRef = tripDocRef;
  window.firebaseFns = { getDoc, setDoc, onSnapshot };
</script>

<!-- ä½ åŸæœ¬çš„ä¸»ç¨‹å¼ -->
<script type="module" src="app.js"></script>

    <!-- Google Maps æ”¾åœ¨æœ€å¾Œï¼Œcallback æœƒå‘¼å« app.js è£¡çš„ initGoogleMaps -->
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDF0UJweH5b2650oRc0_yv6m7R2ykchacc&libraries=places&language=zh-TW&callback=initGoogleMaps"></script>
</body>
</html>
